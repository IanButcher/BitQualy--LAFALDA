<!DOCTYPE html> 
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gesti√≥n de Evaluaciones</title>
    <link rel="stylesheet" href="/header.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="header-options">
            <i class="fas fa-bell"></i>
            <span class="notification-count"></span>
            <img src="https://infonegocios.info/content/cards/82843_Carina%20Campo%20-%20Bitsion.png" alt="Carina Campo" class="profile-img">
        </div>
        <div class="notification-popup" id="notificationPopup">
            <div class="popup-header">
                <h3>Notificaciones</h3>
                <i class="fas fa-times close-popup"></i>
            </div>
            <div class="popup-body" id="popupBody">
                <p>Cargando notificaciones...</p>
            </div>
        </div>
    </header>

    <script>
        // Function to fetch notifications using AJAX
        async function fetchNotifications() {
            try {
                const response = await fetch('/notifications/unread');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const notifications = await response.json();

                const popupBody = document.getElementById('popupBody');
                popupBody.innerHTML = ''; // Clear previous notifications

                if (notifications.length === 0) {
                    popupBody.innerHTML = '<p>No tienes nuevas notificaciones</p>';
                } else {
                    notifications.forEach(notification => {
                        const notificationItem = document.createElement('p');
                        notificationItem.textContent = notification.message;
                        popupBody.appendChild(notificationItem);
                    });
                }
            } 
            catch (error) {
                console.error('Error fetching notifications:', error);
            }
        }

    
        // Poll for new notifications every 5 seconds
        setInterval(fetchNotifications, 5000)
    
        // Call fetchNotifications when the page loads to show existing notifications
        document.addEventListener("DOMContentLoaded", fetchNotifications);
    
        // Event listener to mark notifications as read when the popup is opened
        document.querySelector('.fa-bell').addEventListener('click', async function() {
            await fetch('/notifications/mark-as-read', { method: 'POST' })
        })
    </script>
    
    
</body>
</html>
